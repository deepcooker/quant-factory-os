# 总纲清单（可复制）
0. 你的终局与第一性原则
	•	终局不是“策略最优”，而是“资管财富系统”：Treasury / Growth / Gamble 三账本结构
	•	目标函数核心：下牌桌（hitting probability），而非长期 Sharpe
	•	允许：Gamble 归零；要求：赢了必须锁定并回灌 Treasury
	•	“中央银行”不是 AI 必须信仰的哲学，只是制度化闸门/预算/权限结构

1. 不可变宪法（死规则）
	•	交易所规则不可改：行情获取 / 下单 / 回报 / 对账语义固定（以 repo 参考实现为基线）
	•	研发闭环流程不可改：AI策略创作 → backtesting/极限电池 → replay仿真一致性 → 模拟盘采样 → 问题分析 → 回放数据优化 → 再迭代
	•	错题本/证据链不可变：run_id / trace_id / commit / config_hash / dataset_version 绑定，失败必须归因+防复发测试

2. 三件事路线图（你反复强调的 3 件）
	1.	现有项目测试全通过 + 定基线：把交易所规则/接口契约/系统不变量写成“可测试的宪法”
	2.	定骨架：从策略到回放自迭代的全流程规范 + 错题本标准 + 晋升/淘汰门槛
	3.	设计“自我迭代 AI 工程团队”：多角色分工、权责、评审/门禁、可接力不断片；围绕 goal（200u→千万）按 noyron 方式迭代

3. 你的一期落地（资源约束下的演化）
	•	一期只能落地 B 类：趋势 + 鲨鱼（A类微观套利资源不足）
	•	但必须“靠主设计演化”：先造插槽（账本语义、接口、门禁），未来把 A 类作为插件替换接入，不推翻制度
	•	鲨鱼 L1/L2/L3 本质是不同策略：L1偏磨损/现金流候选；L2/L3偏赌博/凸性（你明确“梭哈输了就输了”）

4. 赌博层（Gamble）在你体系里的正确工程化
	•	传奇式梭哈的自洽前提：赌资来自 现金流/王牌策略供血（母资金池），不是单一本金无限复利
	•	Gamble 必须券化（coupon）：额度上限、频率上限、归零即停、冷却期、严格触发门槛（Gate 不能太宽）
	•	赢了必须 Harvest：回灌 Treasury + 锁定下牌桌本金；Treasury 禁止反向救赌

5. 执行（Execution）的关键结论
	•	“执行”不是接口代码，而是：滑点/拒单/延迟/对账/资金费/容量 —— 把优势变成真钱
	•	执行也必须走“自我迭代工厂”：模拟盘采样真实摩擦 → 回放复现 → 生成执行策略候选 → 极限执行电池 → 错题本 → 晋升替换
	•	Dev平面不能直连外部：建议用你控制的 Gateway（审计/限权/熔断/可回放）

6. 为什么有机会“顶级”，但不保证顶级
	•	做完宪法+工厂+三账本，你会拥有顶级所需的底座（长期演进、证据链、制度化试错）
	•	顶级的最后门槛仍是：真实可持续 edge + 执行成本控制 + 规模化不崩
	•	工厂的意义：把 edge 与执行都变成可迭代、可证伪、可晋升的对象，持续逼近最优

7. 你希望我输出的最终保存稿结构（建议）
	•	Part 1：一页宪法（不可变）
	•	Part 2：三账本资金宪法（Treasury/Growth/Gamble：拨款/回灌/锁定/冻结/重启）
	•	Part 3：自我迭代工厂流程（从策略到回放迭代，含错题本字段）
	•	Part 4：多 AI 角色组织与权责（Planner/Data/Research/Verifier/Release/Incident）
	•	Part 5：一期落地映射（趋势/鲨鱼/L1-L3 如何靠主设计演化）

# 段 1/5：一页宪法（不可变规则，给任何模型/账号都不偏航）
目标：任何人/AI 接手只要遵守这页，就能沿同一方向演化。
	1.	交易所规则不可改
	•	行情获取、账户/仓位、下单/撤单、回报、对账的语义与边界条件固定。
	•	任何实现替换只能“等价”，不得改变语义（以 baseline commit + 测试定义为准）。
	2.	研发闭环不可改（工厂主线）
	•	AI 策略创作 → 极限回测电池 → 回放一致性仿真 → 模拟盘采样 → 问题归因 → 回放数据优化 → 再迭代。
	•	任一环缺失则不允许进入“晋升”。
	3.	证据链不可省
	•	每次实验/回放/模拟盘必须生成 run_id，并绑定：code_commit、config_hash、dataset_version、exchange_env、关键指标摘要。
	•	任何结论必须可复现，不接受“口述正确”。
	4.	错题本必须结构化
	•	每个失败必须记录：现象、归因类别（数据/执行/策略/风控/基础设施）、修复动作、以及“防复发测试/门禁”。
	•	没有防复发测试的修复不算完成。
	5.	三账本财富结构永远存在
	•	Treasury（保全/现金流）、Growth（增长）、Gamble（凸性/彩票）。
	•	Gamble 可归零；Treasury 禁止反向救赌；任何重大胜利必须锁定并回灌 Treasury（下牌桌机制）。
	6.	中央银行只是制度闸门，不要求 AI 信仰
	•	系统必须存在不可绕过的预算/风控/权限闸门；但策略哲学与叙事可变，由工厂在目标函数下探索。


# 段 2/5：三账本资金宪法（Treasury / Growth / Gamble）
这段是你“以终为始”的核心：所有一期实现、未来演化、AI 团队协作，都必须向这套资金规则靠拢。它不依赖具体策略，只依赖账本与规则。

## 2.1 三账本定义（永远存在）
1.	Treasury（主资产库 / 现金流与保全）
•	目标：保住财富、提高生存边界、提供长期供血能力。
•	特征：低回撤、低事故率、可长期运行。
2.	Growth（增长池）
•	目标：用可重复优势复利增长（趋势、结构性 alpha 等）。
•	特征：允许波动，但必须受生存约束与回撤约束。
3.	Gamble（期权/彩票池）
•	目标：捕获极端高赔率跃迁（“10 根 K 线千万”类）。
•	特征：允许归零；但必须券化、稀疏、可冻结、可重启、赢了强制回灌。

⸻

## 2.2 不可逆资金流向（最关键三条）
1.	赢了必须回灌 Treasury（强制 Harvest）
•	任何来自 Growth/Gamble 的阶段性胜利，必须按规则将一部分转入 Treasury 并“锁定”。
2.	Treasury 禁止反向救赌（No Bailout）
•	Gamble 亏损不得触发 Treasury 资金注入救援，不允许“越亏越补”。
3.	Gamble 只能使用“已沉淀利润拨款”
•	Gamble 的资金来源只能是：来自 Treasury/Growth 的已收割利润中划出的“可拨款区”，而不是本金或未沉淀浮盈。

⸻

## 2.3 Gamble 的“券化制度”（Coupon Issuance）
你要的“无限梭哈”必须改写成“无限发券”，否则数学上会被连败压扁。

券（Coupon）：Gamble 的每次下注预算单位。每张券有固定票面成本，可归零。
•	发券来源：仅来自 Coupon Pool（由已收割利润注入）。
•	单券额度：固定或阶梯（例如：Coupon Pool 的 x%，或 Treasury 的 y% 上限）。
•	发券频率上限：
•	每日最多 N 张 / 每周最多 M 张（防止高频负期望磨死）。
•	月度/季度总拨款上限：
•	Coupon Pool 每周期最多消耗不超过某比例（防止无底洞）。
•	券归零处理：
•	该券生命周期结束，立即进入冷却期；禁止加保证金救援；禁止跨券合并救援。

口径：Gamble 可以归零，但必须“归零在券上”，不能归零在系统本金上。

⸻

## 2.4 Freeze / Resume（冻结与重启，必须制度化）
冻结触发（任一满足即冻结）：
•	连续失败达到阈值（例如：连续 K 张券归零）
•	执行环境恶化（拒单率、断线、对账漂移、滑点异常）
•	Treasury/Growth 进入回撤/风险警戒状态（主资产库优先活命）

冻结效果：
•	Gamble 立即停止发券与下注，只保留观测与回放产线。

重启条件（必须更严格）：
•	Treasury/Growth 状态恢复到安全区（风险预算恢复）
•	最近一段时间（窗口）执行指标正常
•	Gamble 的 Gate 通过回放/模拟盘复核（不是感觉）

⸻

## 2.5 Harvest & Lock（下牌桌机制：赢了怎么处理）
这是“下牌桌”的制度化：不写这条，传奇收益会被复赌回吐。

当某策略/某券达到阶段目标（例如资金达到 10k/100k/1m/10m）触发 Harvest：
•	锁定比例（Lockbox）：将一部分收益转入 Treasury 的不可动用区（Lockbox）。
•	回灌比例（Reinvestable Treasury）：一部分进入 Treasury 可运作区，用于提升现金流/安全边界。
•	继续赌博比例（Coupon Pool）：仅允许少量进入 Coupon Pool，保证 Gamble 永远是“期权仓位”，不是主资产。

口径：达到阶段目标后，“系统变得更难死”，而不是“赌得更大”。

⸻

## 2.6 一期资源不足时的“靠拢原则”
你一期只有趋势+鲨鱼（B 类），但三账本语义必须先成立：
•	Growth：主要由趋势承担
•	Gamble：鲨鱼 L2/L3（你明确梭哈归零可接受）
•	Treasury：先由“磨损吸收/低风险现金流候选（如鲨鱼 L1 的防守部分）+ 利润沉淀规则”扮演；未来再用真正 A 类策略替换 Treasury 的策略集合，不改宪法。

⸻

# 段 3/5：自我迭代工厂（从策略创作到回放数据优化的闭环规范）
这段定义“工厂主线”。核心不是写策略，而是让系统能：自动试验 → 自动筛选 → 自动归因 → 自动防复发 → 自动再试验。
这条闭环是宪法级别，不允许缺环。

⸻

## 3.1 工厂的统一对象：Candidate（候选）
任何东西想进入系统迭代，必须被注册成 Candidate（策略/参数/特征/执行策略/数据修复规则都可以是 Candidate）。

Candidate 最少包含：
	•	candidate_id
	•	type：strategy / execution / data_patch / config
	•	spec：描述（可读）
	•	constraints：适用范围/禁用条件
	•	owner_role：哪个角色维护（AI 或人）

⸻

## 3.2 Run（一次实验/回放/模拟盘的最小原子）
每一次运行必须产生 run_id，并绑定最小元信息：
	•	code_commit
	•	config_hash
	•	dataset_version
	•	exchange_env：backtest / replay / paper / live(canary)
	•	start/end time
	•	candidate_id(s)
	•	关键指标摘要（见 3.6）

任何“好/坏”结论必须指向一个 run_id。没 run_id = 口嗨。

⸻

## 3.3 全流程固定管线（不可改顺序）
Step 1：Strategy Creation（候选生成）
	•	来源：AI 生成 / 人编写 / 参数搜索 / 特征组合 / 规则变体
	•	产物：Candidate + 最小 spec（可读）+ 约束条件

Step 2：Extreme Backtesting Battery（极限回测电池）
目的：专门打死过拟合与成本幻觉。
必须包含（至少）：
	•	多市场状态：趋势/震荡/极端（你可以用自定义 regime 标签）
	•	成本模型：手续费、滑点、资金费（perp 必须）
	•	执行约束：限频/拒单模拟、延迟/乱序回报模拟
	•	资金与保证金：强平距离/保证金利用率约束

产物：Backtest run_id + 指标摘要 + 是否通过门槛（pass/fail + 原因）

Step 3：Replay / Simulation Consistency（回放一致性仿真）
目的：让“回测的好看”变成“同输入同输出的可复现”。
要求：
	•	使用固化数据集（D0/D1/D2 版本明确）
	•	输出决策链 trace（signal→intent→risk→order→fill/state）
	•	定义允许的误差边界（例如时间戳抖动、微小滑点差异）
	•	一致性不通过直接淘汰/进入错题本（不是“凑合上线试试”）

Step 4：Paper Trading（模拟盘采样真实摩擦）
目的：采集真实交易所摩擦与异常分布，不是看回测收益。
必须采集两条流（绑定 trace_id/run_id）：
	1.	外部事实流：market/account snapshots（bar/mark/funding/positions/balance）
	2.	内部决策流：signals/risk decisions/orders/executions/state transitions

产物：Paper run_id + 执行指标 + 异常码分布 + 对账一致性报告

Step 5：Issue Analysis（问题分析）
任何失败必须进入 结构化错题本（见 3.5），并给出：
	•	root_cause_type：data / execution / strategy / risk / infra
	•	fix plan：修复候选（data_patch/execution_patch/strategy_patch）
	•	guardrail_test：防复发测试计划

Step 6：Replay-driven Data Optimization（回放驱动数据优化）
目的：把失败变成数据资产与制度改进，而不是“改一改感觉”。
常见输出：
	•	数据对齐修复（乱序/漏包/补缺/时间对齐）
	•	forming bars / 多周期准实时指标规则修复
	•	成本模型修复（滑点/资金费）
	•	执行仿真修复（拒单/限频/延迟）

修复必须生成新 dataset_version 或 candidate_id，并重新跑 Battery + Replay。

Step 7：Promotion / Demotion（晋升/降级）
候选的生命周期：research → backtest_pass → replay_pass → paper_pass → canary_live → scaled
每一步有明确门槛（见 3.6），不允许跳级。

⸻

## 3.4 关键理念：生产核心低变化率
	•	core（交易所规则、状态机、风控闸门）低变化率 + 多人审核
	•	大多数迭代发生在：candidate / config / data_patch / execution_patch

这符合你“改生产代码必须多人审核”的现实。

⸻

## 3.5 错题本（结构化字段，必须项）
每条错题记录至少包含：
	•	issue_id
	•	run_id（必须）
	•	symptom（现象：发生了什么）
	•	root_cause_type（data/execution/strategy/risk/infra）
	•	root_cause_detail（一句话+证据）
	•	fix_candidate_id（修复对应的候选/补丁）
	•	guardrail_test（新增/更新哪些测试防复发）
	•	status：open / fixed / verified / regressed
	•	links：相关日志/图/回放片段

核心：修复必须配套防复发测试，否则不算修复完成。

⸻

## 3.6 晋升门槛（工厂的“裁判”）
你不想学术派空谈，所以门槛必须面向真钱摩擦。最少分三类：

A) 收益类（必须成本后）
	•	现金流/增长/赌博分别用不同指标（赌博看赔率与触发稀疏）
	•	必须扣手续费、滑点、资金费

B) 风险与生存类
	•	最大回撤、尾部损失（CVaR/极端情景）
	•	保证金利用率、强平距离下限
	•	连续亏损/事故触发熔断

C) 执行与可运营类
	•	成交滑点分布、成交率、拒单率、延迟分位数
	•	对账一致性（position/balance drift）
	•	断线/乱序时的自愈与恢复能力

每个阶段至少有一条“硬 fail 条件”（触发即淘汰/冻结）。

⸻

# 段 4/5：多 AI 角色工程团队（自我迭代链路、权责、评审与不断片机制）
这段定义“自治组织”，让 Codex/多模型/多账号都能接力工作。
目标：不靠聊天记忆，靠制度与证据链。

⸻

## 4.1 组织目标（唯一目标函数口径）
	•	团队的工作不是“写代码”，而是：在宪法约束下，提高达到目标资金规模（200u→千万）的概率。
	•	任何任务必须能映射到：提高 edge、降低成本、降低事故率、提高可复现性、提高晋升速度之一。

⸻

## 4.2 角色划分（最小 6 角色，职责互斥）
	1.	Planner（规划/调度）
	•	输入：错题本、run registry、当前目标函数状态
	•	输出：下一轮任务队列（实验/数据修复/执行优化/策略候选）
	2.	Strategy Generator（策略生成）
	•	产 Candidate：策略/参数/特征组合
	•	不拥有预算/上线权
	3.	Data Engineer（数据资产与质量门禁）
	•	负责 D0/D1/D2、forming bars、多周期准实时指标口径
	•	负责数据版本化与质量门禁（漂移/缺失/对齐）
	4.	Execution Engineer（执行策略候选）
	•	负责执行策略 Candidate（限价/市价/拆单/撤改/容错）
	•	目标：滑点、拒单、延迟、对账一致性改善
	5.	Verifier（裁判/评测）
	•	负责跑极限电池、回放一致性、模拟盘指标报表
	•	只能给 verdict：pass/fail + 证据，不写“想法”
	6.	Release Governor（上线与风险门禁）
	•	控制晋升、冻结、回滚
	•	对 core 变更与实盘权限拥有否决权
（可选）7) Incident Analyst（事故归因官）
	•	专门写错题本与防复发测试提案，推动制度收敛

关键：角色互斥 = 防止“生成的人自己给自己发证书”。

⸻

## 4.3 权力结构（谁能做什么）
	•	策略/执行/数据角色：只能提交 Candidate 与证据（run_id），不能直接合并到核心生产路径
	•	Verifier：只判定，不设计
	•	Governor：拥有“放行/冻结/回滚”的权力，负责资金宪法的执行
	•	任何人/AI 都不能绕过交易所规则与资金宪法（通过门禁测试强制）

⸻

## 4.4 协作载体（不断片的关键，不依赖模型记忆）

必须有三类“外置真相源”：
	1.	代码真相（Git）：实现、契约、测试、回放脚本
	2.	运行真相（Run Registry / Artifacts）：每次 run 的指标与产物，绑定 commit/config/data
	3.	决策真相（Journal + 错题本）：为什么改、证据是什么、如何防复发

任何角色断线/换账号，只要读这三类真相源即可接力。

⸻

## 4.5 评审与门禁（保证“改生产必须多人审核”）

把 repo 变成“制度机器”，不是靠自觉：
	•	CODEOWNERS：core/交易所规则/风控/状态机 必须 N 人审核
	•	CI Gate（硬门禁）：
	•	没有新增 run_id 证据 → 不准合并
	•	没有错题本条目/guardrail_test → 不准合并
	•	触碰交易所规则语义测试失败 → 不准合并
	•	晋升门禁：候选必须按 research→backtest→replay→paper→canary 逐级通过，不准跳级

⸻

## 4.6 “永动迭代”机制（任务循环）

团队按固定节拍循环（例如日/周）：
	1.	Planner 根据 registry/错题本生成任务队列
	2.	Generator/Data/Execution 产候选与修复
	3.	Verifier 跑电池并出 verdict
	4.	Analyst 写错题本 + guardrail 测试需求
	5.	Governor 决定晋升/冻结/回滚，并更新资金宪法参数（如拨款频率/冻结阈值）

永动的关键：每轮都必须产出“可复现证据 + 可防复发制度”，否则只是忙。

⸻

## 4.7 执行也靠工厂自我迭代（你强调的点）
	•	执行不是接口实现，而是“把 edge 变成真钱”的能力
	•	工厂要把执行当 Candidate：
	•	模拟盘采样摩擦 → 回放复现 → 执行候选库 → 极限执行电池 → 错题本 → 晋升替换
	•	不同账本（Treasury/Growth/Gamble）允许不同执行 profile，但都受宪法约束（尤其 Gamble 的券化与冻结）

⸻

# 段 5/5：一期落地映射与演化路线（趋势/鲨鱼 → 靠主设计演化到资管财富系统）
这段把你“第一阶段只有趋势+鲨鱼（B类）”与“终局三账本宪法”对齐：一期怎么做不锁死，后面怎么演化，顶级分水岭在哪里。

---

## 5.1 一期现实约束与定位
- 一期资源：只有 B 类策略可落地（趋势 + 鲨鱼）
- A 类微观套利/做市/跨所能力不足（算力、基础设施、数据与执行资源不够）
- 但一期必须按“以终为始”设计：先满足三账本语义与闭环工厂，策略只是插件。

---

## 5.2 一期到终局的“映射原则”（不锁死的关键）
一期必须做到：
策略实现可以粗糙，但资金宪法、流程宪法、证据链宪法必须先成立。

因此一期要优先保证：
- 三账本（Treasury/Growth/Gamble）在系统中是显式对象
- 资金流向规则不可逆（赢了回灌 Treasury、Treasury 不救赌、Gamble 券化）
- 工厂闭环能跑（run_id/回放/错题本/晋升）

---

## 5.3 策略层：趋势与鲨鱼在三账本中的归属（一期推荐口径）
你已经明确：鲨鱼 L2/L3 有赌博逻辑，“输了就输了”；鲨鱼 L1 更像磨损吸收/防守现金流候选。

- Growth（增长池）：主要由 趋势引擎承担（右尾增长/方向性 alpha）
- Gamble（彩票池）：主要由 鲨鱼 L2/L3承担（券化梭哈/凸性机会，允许归零）
- Treasury（主资产库）：一期用 **“鲨鱼 L1 的防守/磨损吸收部分 + 利润沉淀规则”**充当替身
- 注意：一期 Treasury 不一定“无风险套利”，但必须具备“降低整体回撤、提高生存边界”的制度作用
- 未来 A 类只是替换 Treasury 的策略集合，不动宪法

---

## 5.4 鲨鱼三段（L1/L2/L3）在终局视角的定位
- L1（磨损吸收/现金流候选）
- 目标：在震荡/假突破期减少趋势磨损
- 风格：低风险、可停机、以稳定为优先
- L2/L3（券化赌博/凸性）
- 目标：捕获极端赔率跃迁，允许归零
- 关键：必须被 “Coupon issuance + Freeze/Resume + Harvest&Lock” 约束
- 频率不能靠感觉：必须由 Gate 与发券制度控制（避免高频负期望磨死供血池）

---

## 5.5 演化路线（从一期 B 类到主设计）
### 阶段 I（现在）：B 类撑起三账本语义
- 重点不是增加策略，而是：
- 资金宪法落地（拨款/回灌/锁定/券化/冻结）
- 工厂闭环跑通（回测→回放→模拟盘→错题本→再迭代）
- 执行摩擦与异常采样资产化（为后续迭代提供燃料）

### 阶段 II（靠近终局）：让 Treasury 变“真现金流池”
- 不需要一上来做市/微观套利
- 可以先演化出“低频现金流策略集合”：
- 资金费敏感策略（funding/基差管理）
- 风险溢价/对冲型现金流
- 低频跨合约结构（不依赖超低延迟）
- 目标：真正形成母资金池供血能力（给 Gamble 发券而不伤主资产）

### 阶段 III（资源足够）：接入 A 类微观套利
- 只做一件事：替换 Treasury 的策略集合为更强的 A 类插件
- 资金宪法、流程宪法、证据链宪法不变 → 不推倒重来

---

## 5.6 “顶级”的客观评估结论（你问的那个问题）
- 系统形态上：这条路线能让小团队拥有接近顶级所需的底座（制度化资金结构 + 可回放证据链 + 自我迭代工厂 + 执行自迭代）
- 结果上：是否“到顶级”取决于两道门槛：
  1. 真实可持续的 edge（成本后）：工厂能否持续杀死伪优势并筛出可重复优势
  2. 执行/成本/容量规模化：规模增大后滑点、拒单、资金费、对账事故是否仍可控

**结论一句话：**
实现这套“宪法+工厂+三账本”＝拥有冲击顶级的底座；是否成为顶级＝edge 与执行在规模化下被工厂持续打磨并证明为真。

---

## 5.7 你要的最终一句“以终为始”口号（可贴到仓库顶端）
终局先定：Treasury/Growth/Gamble 三账本 + 不可逆资金宪法 + 工厂闭环与错题本。
一期只落地趋势+鲨鱼，但必须按终局语义运行；未来 A 类只是替换 Treasury 的策略插件，不改变宪法与流程。

---


